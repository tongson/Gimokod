pkgname=linux-t60
_basekernel=3.2
pkgver=${_basekernel}.1
pkgrel=2
pkgdesc="The Linux Kernel for the Thinkpad T60"
arch=('i686' 'x86_64')
url="http://www.kernel.org/"
license=('GPL2')
options=('!strip' '!binchecks')
source=("ftp://ftp.kernel.org/pub/linux/kernel/v3.0/linux-${_basekernel}.tar.xz"
         "http://www.kernel.org/pub/linux/kernel/v3.0/patch-${pkgver}.bz2")
sha256sums=('dd96ed02b53fb5d57762e4b1f573460909de472ca588f81ec6660e4a172e7ba7'
            'e9a26dc5faa309ae5172e3c65081fa98b60befab160fb14d9a75816bbde15626')

build() {
  cd "${srcdir}/linux-${_basekernel}"
  Patch "patch-${pkgver}"
  Patch e268337dfe26dfc7efd422a804dbb27977a3cccc.diff
  Patch sysctl-tcp-quickack.diff
  cp "${srcdir}/config.${CARCH}" ./.config
  make oldconfig
  make -j4 bzImage
}

package() {
  cd "${srcdir}/linux-${_basekernel}"
  KARCH=x86
  _kernver="$(make kernelrelease)"
  install -d -m700 "${pkgdir}/boot"
  install -D -m644 arch/$KARCH/boot/bzImage "${pkgdir}/boot/bzImage"
  install -D -m644 vmlinux "${pkgdir}/usr/src/linux-${_kernver}/vmlinux"
  install -D -m644 Makefile "${pkgdir}/usr/src/linux-${_kernver}/Makefile"
  install -D -m644 kernel/Makefile "${pkgdir}/usr/src/linux-${_kernver}/kernel/Makefile"
  install -D -m644 .config "${pkgdir}/usr/src/linux-${_kernver}/.config"
  cd "${pkgdir}/usr/src"
  ln -sf linux-${_kernver} linux
}

source=(${source[@]-}
        config.i686
        config.x86_64
        e268337dfe26dfc7efd422a804dbb27977a3cccc.diff
        sysctl-tcp-quickack.diff)

sha256sums=(${sha256sums[@]-}
            'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855'
            'f0b221b01cea15ebf7e692d5c3057537a1e8d92efd85c1f437210fb5778c9a72'
            '0ff75934d21e8ece871d561e0b6e4ecb0646604ae7161f29b880df36425ced5b'
            'd67c67cf8b33f9b3af0787c33a581ccb1edbbde0dbb9028653b6a776aeca4f87')
