pkgname=grub
pkgver=1.99
pkgrel=1
url="http://www.gnu.org/software/grub/"
arch=('i686' 'x86_64')
license=('GPL3')
groups=('base')
depends=('udev' 'device-mapper')
makedepends=('xz' 'udev' 'device-mapper')
options=('!emptydirs' 'strip')
build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  sed -i 's:SUBDIRS = grub-core/gnulib . grub-core po docs util/bash-completion.d:SUBDIRS = grub-core/gnulib . grub-core util/bash-completion.d:' Makefile.in
  patch -Np0 -i ../grub-1.99-state-devices.patch
  ./configure --with-platform=pc \
              --prefix=/usr \
              --build=${CBUILD} \
              --host=${CHOST} \
              --bindir=/usr/bin \
              --sbindir=/usr/bin \
              --mandir=/usr/share/man \
              --infodir=/usr/share/info \
              --sysconfdir=/etc \
              --enable-device-mapper \
              --disable-mm-debug \
              --disable-efiemu \
              --disable-nls \
              --disable-werror \
              --disable-grub-mkfont \
              --disable-grub-emu-usb \
              --disable-grub-emu-pci \
              --disable-grub-emu-sdl
   make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  make DESTDIR="${pkgdir}" install
}

source=(ftp://ftp.gnu.org/gnu/grub/grub-1.99.tar.xz
        grub-1.99-state-devices.patch)

sha256sums=('f308148d4c83c6f16a73b58a0cd39381656edb740929028cae7ad5f0d651021b'
            '00eba53f623c41989f604874b2f1b9f08e0966aab2a2d9fc163291658b0b130b')
