pkgname=initramfs
pkgver=20111012
pkgrel=1
pkgdesc="Gimokod initramfs"
arch=('i686' 'x86_64')
url="http://gimokod.org"
license=('LGPL3')
groups=('base')
makedepends=('lvm' 'busybox')

root="${srcdir}/root"
build() {
  install -D -m0755 init "${root}/init"
  install -D -m0644 mdev.conf "${root}/etc/mdev.conf"
  install -D -m0644 lvm.conf "${root}/etc/lvm/lvm.conf"
  install -D -m0755 /bin/busybox "${root}/bin/busybox"
  install -D -m0755 /sbin/lvm.static "${root}/bin/lvm"
  install -d -m0755 "${root}/real_root"
  echo "/dev/ram0     /           ext2    defaults    0 0" > "${root}/etc/fstab"
  echo "proc          /proc       proc    defaults    0 0" >> "${root}/etc/fstab"
  cd "${root}" && ln -sf init linuxrc
}

package() {
  install -d -m0700 "${pkgdir}/boot"
  cd "${root}"
  find . -print > ../list
  echo -e "/dev/console\n/dev/tty1\n/dev/null" >> ../list
  cat ../list | cpio -o -H newc -F "${srcdir}/initramfs.cpio"
  xz -ec "${srcdir}/initramfs.cpio" > "${pkgdir}/boot/initramfs-${pkgver}"
}

source=(${source[@]-}
        init
        lvm.conf
        mdev.conf)

sha256sums=(${sha256sums[@]-}
            '5ffa25d3eae7097f69ff1c06e3b14c343f31a6dd47a0a696a7dbc0056c78c8f9'
            '5a2a7258f4d9d1eca651921cb80678ce27fb9069d780b385645e97873ab86933'
            'e50264fc039d2087a56c7243a6be5bca525d4979b8a1006a2e06f279e9590d6c')
