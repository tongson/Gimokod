# Based upon the PKGBUILD from Arch Linux
pkgname=ipvsadm
pkgver=1.26
pkgrel=4
pkgdesc='The IP Virtual Server administration utility'
arch=('x86_64')
url='http://www.linuxvirtualserver.org/software/ipvs.html'
license=('GPL2')
depends=('libnl1' 'popt' 'ncurses')
makedepends=('pkg-config')
options=('emptydirs')
source=(http://www.linuxvirtualserver.org/software/kernel-2.6/"${pkgname}"-"${pkgver}".tar.gz)
sha256sums=('6d6c46fecb1c532a892616b4445c73b71730e8790d5630f60269fd9cbee0eb2d')

build() {
  cd ${pkgname}-${pkgver}
  Patch 01-fix-not-showing-all-server.patch
  Patch ipvsadm-1.26-buildsystem.patch
  Patch ipvsadm-1.26-stack_smashing.patch
  make INCLUDE="-I.. -I." HAVE_NL=1 STATIC_LIB=0 POPT_LIB="$(pkg-config --libs popt)"

}

package() {
  cd ${pkgname}-${pkgver}
  make BUILD_ROOT="${pkgdir}" SBIN="${pkgdir}/usr/bin" MANDIR=usr/share/man install
  install -d -m0755 "${pkgdir}/usr/lib"
  install -d -m0755 "${pkgdir}/usr/include/ipvs"
  install -m0644 libipvs/libipvs.so "${pkgdir}/usr/lib"
  install -m0644 libipvs/libipvs.h libipvs/ip_vs.h "${pkgdir}/usr/include/ipvs"
}


source=(${source[@]-}
        01-fix-not-showing-all-server.patch
        ipvsadm-1.26-buildsystem.patch
        ipvsadm-1.26-stack_smashing.patch)

sha256sums=(${sha256sums[@]-}
            '767c2d899e66b7b1fa6e7c72d84242c57e05cdcff036c616ea2c13d7f021400f'
            '88391e5122dbb7d8c92385647b2e8856bf7ad7231cfb2e73eda4e422addce198'
            '78cf4f4d79fb2a39afdb532e46793c4e700fa08ecacd9fa2577d53b5ced389bd')
