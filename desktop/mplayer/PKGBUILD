# Based upon the PKGBUILD from Arch Linux
# no libbluray support
pkgname=mplayer
pkgver=34426
pkgrel=3
pkgdesc="A movie player for linux"
arch=('i686' 'x86_64')
depends=('libxss' 'fribidi' 'a52dec' 'libvpx' 'x264' 'libdca' 'lame' 'fontconfig'
    'libgl' 'libxinerama' 'libvdpau' 'xvidcore' 'libcdio' 'libmad' 'libtheora'
    'speex' 'aalib' 'libjpeg' 'faad2' 'libxvmc' 'libass' 'libxxf86vm'
    'rtmpdump' 'giflib')
makedepends=( 'libxxf86vm' 'libmad' 'libcdio' 'libxinerama' 'lame' 'libtheora' 'xvidcore' 'libxss' 'libgl'
              'x264' 'faad2' 'libxvmc' 'libvdpau' 'libdca' 'a52dec' 'libvpx'
              'unzip' 'mesa' 'yasm' 'fontconfig' 'libass')
license=('GPL')
url="http://www.mplayerhq.hu/"
options=('!buildflags' '!emptydirs')
source=(ftp://ftp.archlinux.org/other/${pkgname}/${pkgname}-${pkgver}.tar.xz)
md5sums=('ff81117293e76b59e54debc439d8e612')

build() {
    cd "${srcdir}/${pkgname}"

    ./configure --enable-runtime-cpudetection \
                --confdir=/etc/mplayer \
                --enable-fribidi \
                --enable-vdpau \
                --enable-vidix \
                --enable-gl \
                --enable-mad \
                --enable-libvpx-lavc \
                --enable-mp3lame \
                --enable-mp3lame-lavc \
                --enable-mp3lib \
                --disable-toolame \
                --disable-twolame \
                --disable-inet6 \
                --disable-libnut \
                --disable-unrarexec \
                --disable-smb \
                --disable-lirc \
                --disable-lircc \
                --disable-apple-ir \
                --disable-cdparanoia \
                --charset=UTF-8 \
                --disable-tv-bsdbt848 \
                --disable-ivtv \
                --enable-networking \
                --enable-tv-v4l2 \
                --disable-libdirac-lavc \
                --disable-libschroedinger-lavc \
                --disable-libopencore_amrnb \
                --disable-libopencore_amrwb \
                --disable-live \
                --disable-mpg123 \
                --disable-tga \
                --enable-speex \
                --disable-libopenjpeg \
                --enable-librtmp \
                --disable-mencoder \
                --disable-faac-lavc \
                --disable-qtx \
                --enable-aa \
                --disable-fbdev \
                --disable-caca \
                --disable-zr \
                --disable-mga \
                --disable-xmga \
                --disable-3dfx \
                --disable-tdfxvid \
                --disable-tdfxfb \
                --disable-xvr100 \
                --disable-esd \
                --disable-jack \
                --disable-ladspa \
                --disable-nas \
                --disable-openal \
                --disable-pulse \
                --disable-ossaudio \
                --disable-dga1 \
                --disable-dga2 \
                --disable-vesa \
                --disable-dxr3 \
                --disable-ggi \
                --disable-mng \
                --disable-enca \
                --disable-nemesi \
                --disable-sdl \
                --prefix=/usr \
                --disable-gui \
                --disable-arts \
                --disable-liblzo \
                --disable-openal \
                --disable-libdv \
                --disable-musepack \
                --disable-esd \
                --disable-ass-internal \
                --with-xvmclib=XvMCW \
                --enable-xvmc \
                --extra-ldflags="-laa -lrtmp -lvpx -lxvidcore"
    [ "$CARCH" = "i686" ] &&  sed 's|-march=i486|-march=i686|g' -i config.mak

    make
}

package() {
    cd "${srcdir}/${pkgname}"
    make DESTDIR="${pkgdir}" install-mplayer install-mplayer-man
    install -Dm644 etc/{codecs.conf,input.conf,example.conf} "${pkgdir}"/etc/mplayer/
}

