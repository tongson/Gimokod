pkgname=lfpfonts-fix
pkgver=0.83
pkgrel=1
pkgdesc="Linux Font Project fixed-width fonts"
arch=('any')
url="http://sourceforge.net/projects/xfonts/"
makedepends=('ebdftopcf' 'xorg-mkfontscale' 'xorg-mkfontdir')
license=('PD')
options=('!strip' '!binchecks')

_ebdftopcf() {
  local bdffiles
  bdffiles="$@"
  make -f /usr/share/ebdftopcf/Makefile.ebdftopcf \
  BDFFILES="${bdffiles}"
}

build() {
  cd "${srcdir}/lfpfonts-fix-src"
  patch -p0 < ../lfpfonts-fix-0.83-noglyph.patch
}

package() {
  cd "${srcdir}/lfpfonts-fix-src/src"
  sed -i -e '/^FONT /s/\(.*-\)C*-/\1C-/' *.bdf
  BDFFILES="$(find . -name '*.bdf')"
  _ebdftopcf ${BDFFILES}
  install -d "${pkgdir}/usr/share/fonts/${pkgname}"
  install *.pcf.gz -m644 "${pkgdir}/usr/share/fonts/${pkgname}/"
  mkfontscale "${pkgdir}/usr/share/fonts/${pkgname}/"
  mkfontdir "${pkgdir}/usr/share/fonts/${pkgname}/"
}

source=(http://downloads.sourceforge.net/sourceforge/xfonts/${pkgname}-src-${pkgver}.tar.bz2
        lfpfonts-fix-0.83-noglyph.patch)
sha256sums=('f501e45ee105eb006515747178c2872cc4bdd29c4ec8fc39d01d3ce25de6d71f'
            'a2ee182c6ae0d8735b8d86c9a9d59f9a33766ea573313653198c3653a23293b2')
