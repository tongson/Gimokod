From: Andrew Paprocki <andrew@ishiboo.com>
Date: Mon, 11 Jul 2011 17:32:47 -0700
Subject: Bug 665819: build fix for ENABLE_YARR_JIT=0, r=dmandelin

---
 js/src/jsregexpinlines.h         |    2 ++
 js/src/yarr/OSAllocatorPosix.cpp |    2 +-
 js/src/yarr/wtfbridge.h          |    6 ++++++
 3 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/js/src/jsregexpinlines.h b/js/src/jsregexpinlines.h
index 09f933a..129f0b4 100644
--- a/js/src/jsregexpinlines.h
+++ b/js/src/jsregexpinlines.h
@@ -491,7 +491,9 @@ RegExp::compileHelper(JSContext *cx, JSLinearString &pattern, TokenStream *ts)
     }
 #endif
 
+#if ENABLE_YARR_JIT
     codeBlock.setFallBack(true);
+#endif
     byteCode = JSC::Yarr::byteCompile(yarrPattern, cx->compartment->regExpAllocator).get();
 
     return true;
diff --git a/js/src/yarr/OSAllocatorPosix.cpp b/js/src/yarr/OSAllocatorPosix.cpp
index 57c240b..99bf061 100644
--- a/js/src/yarr/OSAllocatorPosix.cpp
+++ b/js/src/yarr/OSAllocatorPosix.cpp
@@ -29,7 +29,7 @@
 
 #include "assembler/wtf/Platform.h"
 
-#if ENABLE_ASSEMBLER && WTF_OS_UNIX && !WTF_OS_SYMBIAN
+#if WTF_OS_UNIX && !WTF_OS_SYMBIAN
 
 #include "OSAllocator.h"
 
diff --git a/js/src/yarr/wtfbridge.h b/js/src/yarr/wtfbridge.h
index 9b2b993..ef7435c 100644
--- a/js/src/yarr/wtfbridge.h
+++ b/js/src/yarr/wtfbridge.h
@@ -50,7 +50,9 @@
 #include "jstl.h"
 #include "vm/String.h"
 #include "assembler/wtf/Platform.h"
+#if ENABLE_YARR_JIT
 #include "assembler/jit/ExecutableAllocator.h"
+#endif
 
 namespace JSC { namespace Yarr {
 
@@ -261,6 +263,8 @@ deleteAllValues(Vector<T, N> &v) {
     v.deleteAllValues();
 }
 
+#if ENABLE_YARR_JIT
+
 /*
  * Minimal JSGlobalData. This used by Yarr to get the allocator.
  */
@@ -272,6 +276,8 @@ class JSGlobalData {
      : regexAllocator(regexAllocator) { }
 };
 
+#endif
+
 /*
  * Sentinel value used in Yarr.
  */
